#!/bin/bash
# Mock systemd-confext for testing

# Parse arguments
ACTION=""
MUTABLE=""
JSON=""

while [[ $# -gt 0 ]]; do
    case $1 in
        merge|unmerge|status)
            ACTION="$1"
            shift
            ;;
        --mutable=*)
            MUTABLE="${1#*=}"
            shift
            ;;
        --json=*)
            JSON="${1#*=}"
            shift
            ;;
        *)
            echo "Unknown option: $1" >&2
            exit 1
            ;;
    esac
done

# Simulate different behaviors based on action
case "$ACTION" in
    merge)
        if [ "$JSON" = "short" ]; then
            echo '{"action":"merge","type":"confext","status":"success","extensions":["config-ext-1"]}'
        else
            echo "Merged configuration extensions: config-ext-1"
        fi
        ;;
    unmerge)
        if [ "$JSON" = "short" ]; then
            echo '{"action":"unmerge","type":"confext","status":"success","extensions":["config-ext-1"]}'
        else
            echo "Unmerged configuration extensions: config-ext-1"
        fi
        ;;
    status)
        if [ "$JSON" = "short" ]; then
            # JSON format similar to real systemd-confext
            echo '[{"hierarchy":"/etc","extensions":["config-ext-1"],"since":1705243810000000}]'
        else
            # Mock status output similar to real systemd-confext
            echo "HIERARCHY EXTENSIONS  SINCE                      "
            echo "/etc      config-ext-1 Tue 2025-01-14 15:30:10 UTC"
        fi
        ;;
    *)
        echo "Invalid action: $ACTION" >&2
        exit 1
        ;;
esac

exit 0
